<!DOCTYPE html>
<html>
<head>
	<title>Lookmap</title>
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<link rel="stylesheet" href="jquery.mobile-1.4.0.css"/>
    <!--http://themeroller.jquerymobile.com/-->
    <link rel="stylesheet" href="gp-test-theme.css"/>
    <link rel="stylesheet" href="leaflet.css"/>
    <link rel="stylesheet" href="leaflet-dvf/css/dvf.css"/>
    <script src="http://debug.phonegap.com/target/target-script-min.js#8f6f4dfe-74bf-11e3-aa44-22000a98b3d6"></script>       
    <script type="text/javascript" charset="utf-8" src="jquery-1.10.2.js"></script> 
    <script type="text/javascript" charset="utf-8" src="jquery.mobile-1.4.0.js"></script>
    <script type="text/javascript" charset="utf-8" src="phonegap-1.4.1.js"></script>
    <!--<script type="text/javascript" charset="utf-8" src="stopgap.js"></script>-->
    <script type="text/javascript" src="leaflet.js"></script>
    <script type="text/javascript" src="map-icons.js"></script>
    <script type="text/javascript" src="jsonsql-0.1.js"></script>
    <script type="text/javascript" src="leaflet-dvf/leaflet-dvf.js"></script>
    <script type="text/javascript" src="leaflet-dvf/leaflet-dvf.markers.js"></script>
    <script type="text/javascript">
        document.addEventListener("deviceready", onDeviceReady, false);

        // once the device ready event fires, you can safely do your thing! -jm
        function onDeviceReady() {
            console.log(device.name);

            var data = [
    {
        "picture": "http://placehold.it/32x32",
        "type": "Restauracje",
        "name": "Esther Peck",
        "randomArrayItem": "apple",
        "longitude": 19.967411999999999,
        "email": "estherpeck@nixelt.com",
        "phone": "+48 (990) 446-3409",
        "address": "147 Pilling Street, Courtland, Washington, 3357",
        "latitude": 50.046408,
        "guid": "0b7e9145-8fb4-47a2-91f9-0d2fbbfeb485",
        "id": 0
    },
    {
        "picture": "http://placehold.it/32x32",
        "type": "Restauracje",
        "name": "Fowler Obrien",
        "randomArrayItem": "cherry",
        "longitude": 19.905286,
        "email": "fowlerobrien@nixelt.com",
        "phone": "+48 (829) 582-2726",
        "address": "128 Amity Street, Blackgum, Kentucky, 8925",
        "latitude": 50.042897000000004,
        "guid": "09ded769-f04a-41c6-a1ff-c02aa8f15421",
        "id": 1
    },
    {
        "picture": "http://placehold.it/32x32",
        "type": "Kluby",
        "name": "Cline Ortega",
        "randomArrayItem": "cherry",
        "longitude": 19.913837999999998,
        "email": "clineortega@nixelt.com",
        "phone": "+48 (871) 414-2596",
        "address": "260 Varanda Place, Needmore, New Mexico, 5173",
        "latitude": 50.020744000000001,
        "guid": "167e0e36-f230-4fd3-9dba-4b4c0f31ee9c",
        "id": 2
    },
    {
        "picture": "http://placehold.it/32x32",
        "type": "Kluby",
        "name": "Hinton Joyner",
        "randomArrayItem": "apple",
        "longitude": 19.933634999999999,
        "email": "hintonjoyner@nixelt.com",
        "phone": "+48 (985) 405-3586",
        "address": "658 Gilmore Court, Loveland, California, 8665",
        "latitude": 50.050289999999997,
        "guid": "f5c74eda-814d-46c7-b631-e9f45116db94",
        "id": 3
    },
    {
        "picture": "http://placehold.it/32x32",
        "type": "Puby",
        "name": "Small Hull",
        "randomArrayItem": "lemon",
        "longitude": 19.970227999999999,
        "email": "smallhull@nixelt.com",
        "phone": "+48 (837) 498-3281",
        "address": "806 Walker Court, Glenville, New York, 6592",
        "latitude": 50.031891999999999,
        "guid": "c0de31b4-8694-42ae-856a-fc8b286d9cd5",
        "id": 4
    },
    {
        "picture": "http://placehold.it/32x32",
        "type": "Puby",
        "name": "Cristina Baldwin",
        "randomArrayItem": "cherry",
        "longitude": 19.942634999999999,
        "email": "cristinabaldwin@nixelt.com",
        "phone": "+48 (813) 410-3683",
        "address": "882 Alabama Avenue, Grenelefe, Georgia, 8187",
        "latitude": 50.067639,
        "guid": "7a004c6c-94c6-4a4d-a838-ce9af0130064",
        "id": 5
    },
    {
        "picture": "http://placehold.it/32x32",
        "type": "Uslugi",
        "name": "Georgette Klein",
        "randomArrayItem": "lemon",
        "longitude": 19.987807,
        "email": "georgetteklein@nixelt.com",
        "phone": "+48 (942) 449-3532",
        "address": "225 Locust Avenue, Cumberland, Arizona, 4465",
        "latitude": 50.079143999999999,
        "guid": "86ea2e51-e918-429d-9a69-e3a70f7dc7b7",
        "id": 6
    },
    {
        "picture": "http://placehold.it/32x32",
        "type": "Uslugi",
        "name": "Angeline Fuller",
        "randomArrayItem": "apple",
        "longitude": 19.928182,
        "email": "angelinefuller@nixelt.com",
        "phone": "+48 (925) 592-3622",
        "address": "752 Poplar Avenue, Takilma, Delaware, 5051",
        "latitude": 50.040501999999996,
        "guid": "cdbfb462-d4f4-4bd0-97c7-708f3bfa8aa1",
        "id": 7
    },
    {
        "picture": "http://placehold.it/32x32",
        "type": "Rozrywka",
        "name": "Howard Mason",
        "randomArrayItem": "apple",
        "longitude": 19.909469000000001,
        "email": "howardmason@nixelt.com",
        "phone": "+48 (864) 536-2802",
        "address": "949 Cranberry Street, Baden, Florida, 3821",
        "latitude": 50.024330999999997,
        "guid": "1f1bbf04-4241-48f4-b74d-61b0cf5668f5",
        "id": 8
    }
];

                        var addType = function (json, iconType) {
                            var layer = new L.LayerGroup();
                            for (var j = 0; j < json.length; j++) {
                                var longtitude = json[j].longitude;
                                var latitude = json[j].latitude;
                                var name = json[j].name;
                                if (iconType !== undefined) {
                                    L.marker([latitude, longtitude], { icon: iconType }).bindPopup(name).addTo(layer);
                                }
                                else {
                                    L.marker([latitude, longtitude]).bindPopup(name).addTo(layer);
                                }
                            }
                            return layer;
                        };
                        var cloudMadeAttribution = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
                        var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/{styleId}/256/{z}/{x}/{y}.png';
                        var minimal = L.tileLayer(cloudmadeUrl, { styleId: 22677, attribution: cloudMadeAttribution }),
                            midnight = L.tileLayer(cloudmadeUrl, { styleId: 999, attribution: cloudMadeAttribution });

                        var MarkerIcon = L.Icon.extend({
                            options: {
                                shadowUrl: 'images/icons-png/leaf-shadow.png',
                                iconSize: [38, 95],
                                shadowSize: [50, 64],
                                iconAnchor: [22, 94],
                                shadowAnchor: [4, 62],
                                popupAnchor: [-3, -76]
                            }
                        });

                        var restaurantMarkerIcon = new MarkerIcon({ iconUrl: 'images/icons-png/leaf-red.png' });
                        var pubsMarkerIcon = new MarkerIcon({ iconUrl: 'images/icons-png/leaf-green.png' });
                        var clubsMarkerIcon = new MarkerIcon({ iconUrl: 'images/icons-png/leaf-orange.png' });

                        var restaurantsLayer = addType(jsonsql.query("select * from json where (type =='Restauracje')", data), restaurantMarkerIcon);
                        var pubsLayer = addType(jsonsql.query("select * from json where (type =='Puby')", data), pubsMarkerIcon);
                        var clubsLayer = addType(jsonsql.query("select * from json where (type =='Kluby')", data), clubsMarkerIcon);
                        var servicesLayer = addType(jsonsql.query("select * from json where (type =='Uslugi')", data));
                        var entertainmentLayer = addType(jsonsql.query("select * from json where (type =='Rozrywka')", data));

                        var map = L.map('map', {
                            center: [50.05185, 19.96195],
                            zoom: 13,
                            layers: [minimal, restaurantsLayer, pubsLayer, clubsLayer, servicesLayer, entertainmentLayer]
                        });

                        var baseLayers = {
                            "Minimalny": minimal,
                            "Widok nocny": midnight
                        };

                        var overlays = {
                            "Restauracje": restaurantsLayer,
                            "Puby": pubsLayer,
                            "Kluby": clubsLayer,
                            "Usługi": servicesLayer,
                            "Rozrywka": entertainmentLayer
                        };
                        L.control.layers(baseLayers, overlays).addTo(map);
               

        }
    </script>
</head>
    <body>
        <div id="home" data-role="page">
            <div data-role="header">
                 <a href="#dialogpage" data-rel="dialog" data-icon="user">Settings</a>
            </div>
            <div data-role="content">
                <div id="map"></div>
            </div>
        </div>

       <div id="dialogpage" data-role="page">
          <div data-role="content">
              <div data-role="header">
                 <h1>Message</h1>
              </div>
                  This is just a message
              </div>
      </div>

        <!--<script type="text/javascript">
            StopGap();
        </script>-->
    </body>
</html>
